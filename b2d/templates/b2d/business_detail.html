{% extends "b2d/base.html" %}
{% block content %}
    {% load static %}
    <div class="container mt-4">
        <div class="card">
            <div class="row g-0">
                <div class="col-md-8">
                    <div id="imageCarousel" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-indicators">
                            {% if photo1_url %}
                            <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="0" class="active"
                                    aria-current="true" aria-label="Slide 1"></button>
                            {% endif %}
                            {% if photo2_url %}
                                <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="1"
                                        aria-label="Slide 2"></button>
                            {% endif %}
                            {% if photo3_url %}
                                <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="2"
                                        aria-label="Slide 3"></button>
                            {% endif %}
                            {% if youtube_video_embed %}
                                <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="3"
                                        aria-label="Slide 4"></button>
                            {% endif %}
                        </div>

                        <div class="carousel-inner">
                            {% if photo1_url %}
                            <div class="carousel-item active">
                                <img src="{{ photo1_url }}" class="d-block w-100" alt="{{ business.name }} Image"
                                     style="height: 300px;">
                            </div>
                            {% endif %}
                            {% if photo2_url %}
                                <div class="carousel-item">
                                    <img src="{{ photo2_url }}" class="d-block w-100" alt="Additional Image"
                                         style="height: 300px;">
                                </div>
                            {% endif %}
                            {% if photo3_url %}
                                <div class="carousel-item">
                                    <img src="{{ photo3_url }}" class="d-block w-100" alt="Additional Image"
                                         style="height: 300px;">
                                </div>
                            {% endif %}
                            {% if youtube_video_embed %}
                                <div class="carousel-item">
                                    <iframe class="d-block w-100" src="{{ youtube_video_embed }}" frameborder="0"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen style="height: 300px;"></iframe>
                                </div>
                            {% endif %}
                        </div>

                        {% if photo2_url or photo3_url or youtube_video_embed %}
                            <button class="carousel-control-prev" type="button" data-bs-target="#imageCarousel"
                                    data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#imageCarousel"
                                    data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card-body">
                        <h1 class="card-title">{{ business.name }}</h1>
                        <p class="card-text">{{ business.description }}</p>
                        {% with fundraisings.last as fundraise %}
                            <h3 class="card-text">Raised: ${{ fundraise.get_current_investment|default:"0" }}</h3>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar"
                                     style="width: {{ fundraise.get_percentage_investment }}%;"
                                     aria-valuenow="{{ fundraise.get_current_investment }}" aria-valuemin="0"
                                     aria-valuemax="{{ fundraise.goal_amount }}"></div>
                            </div>
                            <button class="btn btn-dark invest-button mt-3">Invest in {{ business.name }}</button>
                        {% endwith %}
                    </div>
                </div>
            </div>

            <div class="row text-center card-content-text p-0 m-0">
                {% with fundraisings.last as fundraise %}
                    <div class="col-sm-3 pt-2">
                        <h5>{{ fundraise.investment_set.count }}</h5>
                        <p>Investors</p>
                    </div>
                    <div class="col-sm-3 pt-2" style="border-left: 2px solid white;">
                        <h5>{{ fundraise.deadline_date|date:"d M Y" }}</h5>
                        <p>left to invest</p>
                    </div>
                    <div class="col-sm-3 pt-2" style="border-left: 2px solid white;">
                        <h5>${{ fundraise.goal_amount }}</h5>
                        <p>Funding goal</p>
                    </div>
                    <div class="col-sm-3 pt-2" style="border-left: 2px solid white;">
                        <h5>${{ fundraise.minimum_investment|default:"0" }}</h5>
                        <p>Minimum invest</p>
                    </div>
                {% endwith %}
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                {% for pitch in pitch_data %}
                    <div class="mt-4">
                        <h3 class="card-title">{{ pitch.topic }}</h3>
                        <p class="card-text">{{ pitch.details }}</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-4 ">
            <div class="team-content m-4 rounded pt-4 pb-4" style="background: rgba(128, 123, 123, .3); border">
                <div style="text-align: center;">
                    <h3><u>Team</u></h3>
                </div>
                {% for member in team_members_data %}
                    <div class="team-card mx-5 p-3 rounded-3">
                        <div>
                            <img src="{{ member.photo_url }}" class="img-fluid" alt="{{ member.name }}"
                                 style="width: 200px; height:150px;">
                        </div>
                        <h5>{{ member.name }}</h5>
                        <p>{{ member.work_as }}</p>
                    </div>
                {% empty %}
                    <p>No team members found.</p>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
